<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Interact with Databricks foundation models • chattr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Interact with Databricks foundation models">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">chattr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/backend-databricks.html">Interact with Databricks foundation models</a></li>
    <li><a class="dropdown-item" href="../articles/backend-llamagpt.html">Interact with local models</a></li>
    <li><a class="dropdown-item" href="../articles/copilot-chat.html">Interact with GitHub Copilot Chat</a></li>
    <li><a class="dropdown-item" href="../articles/openai-gpt.html">Interact with OpenAI GPT models</a></li>
    <li><a class="dropdown-item" href="../articles/other-interfaces.html">Other interfaces</a></li>
    <li><a class="dropdown-item" href="../articles/prompt_defaults.html">Modify prompt enhancements</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mlverse/chattr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Interact with Databricks foundation models</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mlverse/chattr/blob/main/vignettes/backend-databricks.Rmd" class="external-link"><code>vignettes/backend-databricks.Rmd</code></a></small>
      <div class="d-none name"><code>backend-databricks.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="intro">Intro<a class="anchor" aria-label="anchor" href="#intro"></a>
</h2>
<p><a href="https://docs.databricks.com/en/introduction/index.html" class="external-link">Databricks</a>
customers have access to <a href="https://docs.databricks.com/en/machine-learning/foundation-models/index.html" class="external-link">foundation
model APIs</a> like DBRX, Meta Llama 3 70B, and Mixtral 8x7B. Databricks
also provides the ability to train and <a href="https://docs.databricks.com/en/machine-learning/foundation-models/deploy-prov-throughput-foundation-model-apis.html" class="external-link">deploy
custom models</a>.</p>
<p><code>chattr</code> supports the following models on Databricks by
default:</p>
<table class="table">
<caption><a href="https://docs.databricks.com/en/machine-learning/foundation-models/index.html#pay-per-token-foundation-model-apis" class="external-link">Supported
Databricks pay-per-token foundation models</a></caption>
<colgroup>
<col width="29%">
<col width="41%">
<col width="29%">
</colgroup>
<thead><tr class="header">
<th>Model</th>
<th>Databricks Model Name</th>
<th>
<code>chattr</code> Name</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>DBRX Instruct</td>
<td><code>databricks-dbrx-instruct</code></td>
<td><code>databricks-dbrx</code></td>
</tr>
<tr class="even">
<td>Meta-Llama-3-70B-Instruct</td>
<td><code>databricks-meta-llama-3-70b-instruct</code></td>
<td><code>databricks-meta-llama3-70b</code></td>
</tr>
<tr class="odd">
<td>Mixtral-8x7B Instruct</td>
<td><code>databricks-mixtral-8x7b-instruct</code></td>
<td><code>databricks-mixtral8x7b</code></td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="authentication">Authentication<a class="anchor" aria-label="anchor" href="#authentication"></a>
</h2>
<p>Databricks requires a <a href="https://docs.databricks.com/en/workspace/workspace-details.html#workspace-instance-names-urls-and-ids" class="external-link"><strong>host</strong></a>
(workspace URL) and <a href="https://docs.databricks.com/en/dev-tools/auth/pat.html#databricks-personal-access-tokens-for-workspace-users" class="external-link"><strong>token</strong></a>
to authenticate. Both are required for any non-Databricks application,
such as <code>chattr</code>, to interact with the models in the
Databricks workspace.</p>
<p>The token can be generated by the user in the workspace under the
developer settings (<a href="https://docs.databricks.com/en/dev-tools/auth/pat.html#databricks-personal-access-tokens-for-workspace-users" class="external-link">docs</a>)
and the host can be found in the workspaces URL (<a href="https://docs.databricks.com/en/workspace/workspace-details.html#workspace-instance-names-urls-and-ids" class="external-link">docs</a>).</p>
<p>By default, <code>chattr</code> will look for the credentials in
environment variables:</p>
<ul>
<li><p><code>DATABRICKS_HOST</code></p></li>
<li><p><code>DATABRICKS_TOKEN</code></p></li>
</ul>
<p>Use <code><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv()</a></code> to set the variable. The downside of
using this method is that the variable will only be available during the
current R session:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span><span class="st">"DATABRICKS_HOST"</span> <span class="op">=</span> <span class="st">"https://xxxxx.cloud.databricks.com"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span><span class="st">"DATABRICKS_TOKEN"</span> <span class="op">=</span> <span class="st">"####################"</span><span class="op">)</span></span></code></pre></div>
<p>A preferred method is to save the secret key to the
<code>.Renviron</code> file. This way, there is no need to load the
environment variable every time you start a new R session. The
<code>.Renviron</code> file is available in your home directory. Here is
an example of the entry:</p>
<pre><code>DATABRICKS_HOST = https://xxxxx.cloud.databricks.com
DATABRICKS_TOKEN = ####################</code></pre>
</div>
<div class="section level2">
<h2 id="change-the-model">Change the model<a class="anchor" aria-label="anchor" href="#change-the-model"></a>
</h2>
<div class="section level3">
<h3 id="supported-models">Supported Models<a class="anchor" aria-label="anchor" href="#supported-models"></a>
</h3>
<p>By default, <code>chattr</code> is setup to interact with GPT 4
(<code>gpt-4</code>). To switch to Meta Llama 3 70B you can run:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mlverse/chattr" class="external-link">chattr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/chattr_use.html">chattr_use</a></span><span class="op">(</span><span class="st">"databricks-meta-llama3-70b"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── chattr</span></span>
<span><span class="co">#&gt; • <span style="color: #000000;">Provider:</span> <span style="color: #0000BB;">Databricks</span></span></span>
<span><span class="co">#&gt; • <span style="color: #000000;">Path/URL:</span> <span style="color: #0000BB;">serving-endpoints</span></span></span>
<span><span class="co">#&gt; • <span style="color: #000000;">Model:</span> <span style="color: #0000BB;">databricks-meta-llama-3-70b-instruct</span></span></span>
<span><span class="co">#&gt; • <span style="color: #000000;">Label:</span> <span style="color: #0000BB;">Meta Llama 3 70B (Databricks)</span></span></span></code></pre></div>
<div class="section level4">
<h4 id="custom-models">Custom Models<a class="anchor" aria-label="anchor" href="#custom-models"></a>
</h4>
<p>If a model doesn’t appear in the supported table but is deployed on
<a href="https://docs.databricks.com/en/machine-learning/model-serving/index.html" class="external-link">Databricks
model serving</a> as OpenAI-compatible (<a href="https://mlflow.org/docs/latest/llms/deployments/index.html#general-configuration-parameters" class="external-link">configured
with <code>llm/v1/chat</code> in mlflow</a>) then you can specify the
model name explicitly with <code><a href="../reference/chattr_use.html">chattr_use()</a></code></p>
<p>For example if you have deployed a fine-tuned version LLM with an
endpoint name of <code>"CustomLLM"</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mlverse/chattr" class="external-link">chattr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># use any existing databricks foundation model name (e.g. datarbicks-dbrx)</span></span>
<span><span class="co"># then adjust the default model name to 'CustomMixtral'</span></span>
<span><span class="fu"><a href="../reference/chattr_use.html">chattr_use</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"databricks-dbrx"</span>, model <span class="op">=</span> <span class="st">"CustomLLM"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── chattr</span></span>
<span><span class="co">#&gt; • <span style="color: #000000;">Provider:</span> <span style="color: #0000BB;">Databricks</span></span></span>
<span><span class="co">#&gt; • <span style="color: #000000;">Path/URL:</span> <span style="color: #0000BB;">serving-endpoints</span></span></span>
<span><span class="co">#&gt; • <span style="color: #000000;">Model:</span> <span style="color: #0000BB;">CustomLLM</span></span></span>
<span><span class="co">#&gt; • <span style="color: #000000;">Label:</span> <span style="color: #0000BB;">DBRX (Databricks)</span></span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="data-files-and-data-frames">Data files and data frames<a class="anchor" aria-label="anchor" href="#data-files-and-data-frames"></a>
</h2>
<p>Because it is information about your environment and work space, by
default <code>chattr</code> avoids sending any data files, and data
frame information to Databricks. Sending this information is convenient
because it creates a shorthand for your requests. If you wish to submit
this information as part of your prompts, use
<code><a href="../reference/chattr_defaults.html">chattr_defaults()</a></code>, for example:</p>
<ul>
<li><code>chattr_defaults(max_data_files = 10)</code></li>
<li><code>chattr_defaults(max_data_frames = 10)</code></li>
</ul>
<p>These two commands will send 10 data frames, and 10 data files as
part of your prompt. You can decide the number to limit this by. The
more you send, the larger your prompt.</p>
<p>If any of these is set to anything but 0, a warning will show up
every time you start the Shiny app:</p>
<pre><code>• Provider: Databricks
• Path/URL: serving-endpoints
• Model: databricks-dbrx-instruct
• Label: DBRX (Databricks)
! A list of the top 10 files will be sent externally to Databricks with every request
To avoid this, set the number of files to be sent to 0 using chattr::chattr_defaults(max_data_files = 0)Î</code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Edgar Ruiz, Posit Software, PBC.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
